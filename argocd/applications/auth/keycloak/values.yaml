# Keycloak values for AI Security Platform (Home Lab)
# Chart: codecentric/keycloakx 7.1.7

replicas: 1

# Args for production mode
args:
  - "start"
  - "--http-enabled=true"
  - "--hostname-strict=false"
  - "--proxy-headers=xforwarded"

# Disable chart's proxy config (uses deprecated option)
proxy:
  enabled: false

# Database configuration (external PostgreSQL via CNPG)
database:
  vendor: postgres
  hostname: postgresql-cluster-rw.storage.svc
  port: 5432
  database: keycloak
  username: keycloak
  existingSecret: keycloak-db-secret
  existingSecretKey: password

# HTTP settings
http:
  relativePath: "/"

# Health & metrics
health:
  enabled: true
metrics:
  enabled: true

# Ingress via Traefik with TLS
ingress:
  enabled: true
  ingressClassName: traefik
  annotations:
    cert-manager.io/cluster-issuer: ai-platform-ca-issuer
  tls:
    - hosts:
        - auth.ai-platform.localhost
      secretName: keycloak-tls
  rules:
    - host: auth.ai-platform.localhost
      paths:
        - path: /
          pathType: Prefix

# Resources for home lab
resources:
  requests:
    cpu: "250m"
    memory: "512Mi"
  limits:
    cpu: "1000m"
    memory: "768Mi"

# Security context for PSS restricted compliance
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

containerSecurityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  runAsNonRoot: true
  runAsUser: 1000
  seccompProfile:
    type: RuntimeDefault

# Admin credentials
extraEnv: |
  - name: KEYCLOAK_ADMIN
    value: admin
  - name: KEYCLOAK_ADMIN_PASSWORD
    value: admin123
  - name: KC_HOSTNAME
    value: auth.ai-platform.localhost
